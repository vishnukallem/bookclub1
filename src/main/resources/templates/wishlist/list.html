<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Wishlist</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>My Wishlist</h2>

        <!-- New Wishlist Item button -->
        <a class="btn btn-primary my-3" th:href="@{/wishlist/new}">New Wishlist Item</a>

        <!-- Replaces Thymeleaf table with a dynamic div -->
        <div id="wishlist"></div>
    </div>

    <script>
        class HttpClient {
            async get(url) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error("Fetch error: ", error);
                    return [];
                }
            }
        }

        function buildTable(books) {
            let tableString = `
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ISBN</th>
                            <th>Title</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const book of books) {
                tableString += `
                    <tr>
                        <td>${book.isbn || ''}</td>
                        <td>${book.title || ''}</td>
                        <td>
                            <a href="/wishlist/delete/${book.id}" class="btn btn-danger">Delete</a>
                        </td>
                    </tr>
                `;
            }

            tableString += `
                    </tbody>
                </table>
            `;

            return tableString;
        }

        // Load data on page load
        window.onload = async () => {
            const client = new HttpClient();
            const books = await client.get('/api/wishlist');
            document.getElementById('wishlist').innerHTML = buildTable(books);
        };
    </script>
</body>
</html>